<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene shadow="type: pcfsoft">
      <a-assets>
        <img id="skyTexture" src="./skynet.jpg">
        <img id="groundTexture" src="./grass.jpg">
      </a-assets>

      <a-entity light="type: ambient; intensity: 0.4;"></a-entity>
      <a-entity 
        light="type: directional; intensity: 1; castShadow: true" 
        position="2 4 -2">
      </a-entity>

      <a-entity id="rig" position="0 1.6 0">
        <a-entity id="head" camera wasd-controls-enabled="false" look-controls></a-entity>
        <a-entity id="LeftHand" meta-touch-controls="hands:left"></a-entity>
        <a-entity id="RightHand" meta-touch-controls="hands:right"></a-entity>
      </a-entity>

      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"
             shadow="cast: true; receive: true"></a-box>

      <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"
                shadow="cast: true; receive: true"></a-sphere>

      <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"
                  shadow="cast: true; receive: true"></a-cylinder>

      <a-plane position="0 0 -4" rotation="-90 0 0" width="100" height="100"
               src="#groundTexture"
               shadow="cast: false; receive: true"></a-plane>

      <a-sky src="#skyTexture"></a-sky>
    </a-scene>
  </body>
</html>
<script>
    AFRAME.registerComponent('JoystickMovement', {
        init: function () {
            this.direction = new THREE.Vector3();
            this.velocity = new THREE.Vector3();
            this.speed = 0.1; // Vitesse de déplacement
            this.joystick = { x: 0, y: 0 }; // Position du joystick
            this.isMoving = false;

            // Écoute les événements du joystick (à adapter selon la bibliothèque utilisée)
            window.addEventListener('joystickMove', (event) => {
                this.joystick.x = event.detail.x;
                this.joystick.y = event.detail.y;
                this.isMoving = true;
            });

            window.addEventListener('joystickEnd', () => {
                this.joystick.x = 0;
                this.joystick.y = 0;
                this.isMoving = false;
            });
        },
        tick: function (time, deltaTime) {
            if (this.isMoving) {
                // Calcule la direction basée sur la position du joystick
                this.direction.set(this.joystick.x, 0, this.joystick.y).normalize();

                // Applique la vitesse
                this.velocity.copy(this.direction).multiplyScalar(this.speed * (deltaTime / 16));

                // Met à jour la position de l'entité
                const rig = document.getElementById('rig');
                rig.object3D.position.add(this.velocity);
            }
        }
    });
    document.getElementById('LeftHand').setAttribute('JoystickMovement', '');
    AFRAME.registerComponent('JoystickLook', {
        init: function () {
            this.lookSpeed = 0.1; // Vitesse de rotation
            this.joystick = { x: 0, y: 0 }; // Position du joystick
            this.isLooking = false;

            // Écoute les événements du joystick (à adapter selon la bibliothèque utilisée)
            window.addEventListener('joystickLookMove', (event) => {
                this.joystick.x = event.detail.x;
                this.joystick.y = event.detail.y;
                this.isLooking = true;
            });

            window.addEventListener('joystickLookEnd', () => {
                this.joystick.x = 0;
                this.joystick.y = 0;
                this.isLooking = false;
            });
        },
        tick: function (time, deltaTime) {
            if (this.isLooking) {
                const head = document.getElementById('head');
                const rotation = head.getAttribute('rotation');

                // Met à jour la rotation basée sur la position du joystick
                rotation.y -= this.joystick.x * this.lookSpeed * (deltaTime / 16);
                rotation.x -= this.joystick.y * this.lookSpeed * (deltaTime / 16);
                rotation.x = Math.max(-90, Math.min(90, rotation.x)); // Limite la rotation verticale

                head.setAttribute('rotation', rotation);
            }
        }
    });
    document.getElementById('RightHand').setAttribute('JoystickLook', '');

</script>